<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Project Part B</title>
        <script src="d3.v3.min.js" charset="utf-8"></script>
    </head>
    <body>
        <script type="text/javascript">
		var svgWidth = 960;
		var svgHeight = 500;

		var zoom = d3.behavior.zoom();

		var svg = d3.select("body")
			.append("svg")
			.attr("width", svgWidth)
			.attr("height", svgHeight)
			.call(d3.behavior.zoom().on("zoom", function () {
    				svg.attr("transform", "translate(" + d3.event.translate + ")" + " scale(" + d3.event.scale + ")")
  			}))
  .append("g")

		var color = d3.scale.linear()
			.domain([0, 0.5, 1])
			.range(["green", "yellow", "red"]);

/*
		svg.append("rect")
			.attr("width", 10)
			.attr("height", 10)
			.attr("fill", d3.rgb(color(.5)).darker(1))
			.append("title").text("HELLO");

		svg.append("rect")
			.attr("x", 10)
			.attr("width", 10)
			.attr("height", 10)
			.attr("fill", d3.rgb(color(0)).darker(0.5))
			.append("title").text("HELLO2");
*/

		d3.csv("scores.csv", function(dataset) {
			var classes = {};
			for (var i = 0; i < dataset.length; i++) {
				if (dataset[i].class.match(/^java/) || dataset[i].class.match(/^org\/w3c/)) {
					dataset.splice(i--, 1);
					continue;
				}

				if (!(dataset[i].class in classes)) {
					classes[dataset[i].class] = [];
				}

				classes[dataset[i].class].push(dataset[i]);
			}

			console.log(classes);
			var current_score_type = 'tarantula';
			var class_index = 0;
			for (var key in classes) {
				classes[key].sort(function(a, b) {
					var score_a = a[current_score_type];
					var score_b = b[current_score_type];
					if (score_a > score_b) {
						return 1;
					} else if (score_a < score_b) {
						return -1;
					} else {
						return 0;
					}
				});
				
				console.log(classes[key]);	
				svg.append("g").selectAll("rect")
					.data(classes[key]).enter()
					.append("rect")
					.attr("width", 10)
					.attr("height", 10)
					.attr("x", function(d, i) {
						return i * 10;
					})
					.attr("y", class_index * 10)
					.attr("fill", function(d, i) {
						console.log(d[current_score_type]);
						return d3.rgb(color(d[current_score_type]));
					});
				
				class_index++;
			}
		});
	</script>
    </body>
</html>   
