<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Project Part B</title>
        <script src="d3.v3.min.js" charset="utf-8"></script>
    </head>
    <body>
        <script type="text/javascript">
		var svgWidth = 960;
		var svgHeight = 500;

		var zoom = d3.behavior.zoom()
				.scaleExtent([1, 8])
				.on("zoom", zoomed);

		var svg = d3.select("body")
			.append("svg")
			.attr("width", svgWidth)
			.attr("height", svgHeight)
			.attr("align", "center")
			.style("margin", "auto")
			.style("display", "block")
			.call(zoom)
  			.append("g")

		function zoomed() {
			var tx = Math.min(0, Math.max(d3.event.translate[0], svgWidth - svgWidth * d3.event.scale));
			var ty = Math.min(0, Math.max(d3.event.translate[1], svgHeight - svgHeight * d3.event.scale));
			zoom.translate([tx, ty]);
    			svg.attr("transform", "translate(" + [tx, ty] + ")" + " scale(" + d3.event.scale + ")")
		}

		var color = d3.scale.linear()
			.domain([0, 0.5, 1])
			.range(["green", "yellow", "red"]);

		d3.csv("scores.csv", function(dataset) {
			var classes = {};
			for (var i = 0; i < dataset.length; i++) {
				if (dataset[i].class.match(/^java/) || dataset[i].class.match(/^org\/w3c/)) {
					dataset.splice(i--, 1);
					continue;
				}

				if (!(dataset[i].class in classes)) {
					classes[dataset[i].class] = [];
				}

				classes[dataset[i].class].push(dataset[i]);
			}

			console.log(classes);
			var current_score_type = 'tarantula';
			var class_index = 0;
			var class_count = 0;
			var max_method_count = 0;
			for (var key in classes) {
				class_count++;
				max_method_count = Math.max(max_method_count, classes[key].length);
			}
			console.log(max_method_count);
			for (var key in classes) {
				classes[key].sort(function(a, b) {
					var score_a = a[current_score_type];
					var score_b = b[current_score_type];
					if (score_a > score_b) {
						return 1;
					} else if (score_a < score_b) {
						return -1;
					} else {
						return 0;
					}
				});
				
				//console.log(classes[key]);	
				svg.append("g").selectAll("rect")
					.data(classes[key]).enter()
					.append("rect")
					.attr("width", svgWidth / max_method_count)
					.attr("height", 10)
					.attr("x", function(d, i) {
						return i * svgWidth / max_method_count;
					})
					.attr("y", class_index * 10)
					.attr("fill", function(d, i) {
						//console.log(d[current_score_type]);
						return d3.rgb(color(d[current_score_type]));
					})
					.attr("stroke", "black");
				
				class_index++;
			}
		});
	</script>
    </body>
</html>   
